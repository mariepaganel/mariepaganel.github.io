<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Всё устроится математически</title>
  
  <subtitle>Наблюдать и работать</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://mariepaganel.github.io/"/>
  <updated>2018-04-17T16:11:10.596Z</updated>
  <id>http://mariepaganel.github.io/</id>
  
  <author>
    <name>Мария Керсонова</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Перенаправление виртуального хоста для nginx-proxy в Docker</title>
    <link href="http://mariepaganel.github.io/2018/04/nginx-docker-redirect/"/>
    <id>http://mariepaganel.github.io/2018/04/nginx-docker-redirect/</id>
    <published>2018-04-16T10:19:08.000Z</published>
    <updated>2018-04-17T16:11:10.596Z</updated>
    
    <content type="html"><![CDATA[<p>По работе потребовалось: на некоторый период времени перенаправлять запросы на другой сайт (отправлять клиентов, которые не платят за услугу, на страницу оплаты). Используется <a href="https://hub.docker.com/r/jwilder/nginx-proxy/" target="_blank" rel="noopener">автоматический обратный прокси-сервер nginx от jwilder</a>.<br>Решение кажется очевидным и простым (и, вероятно, грубым), но я определённо рада, что нашла хоть такое. Основное преимущество: <strong>настройки в отдельном файле для каждого сайта</strong>, что делает проще автоматизацию перенаправления.</p><p>Для этого при создании контейнера с nginx нужно прописать дополнительные тома для настроек: conf.d для общих настроек и vhost.d, где будут храниться файлы для каждого виртуального хоста.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -p 80:80 -p 443:443 \</span><br><span class="line">  --name nginx \</span><br><span class="line">  -v /path/to/conf.d:/etc/nginx/conf.d \</span><br><span class="line">  -v /path/to/vhost.d:/etc/nginx/vhost.d:ro \</span><br><span class="line">  jwilder/nginx-proxy</span><br></pre></td></tr></table></figure><a id="more"></a><p>Или, если nginx-контейнер запускаем с помощью docker-compose (version: ‘2’), добавить строчки<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">./conf.d:/etc/nginx/conf.d</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">./vhost.d:/etc/nginx/vhost.d:ro</span></span><br></pre></td></tr></table></figure></p><p>Перед созданием контейнера с сайтом в папку vhost.d поместить файл с названием, которое соответствует нашему сайту с добавлением “_location”. Для перенаправления в него нужно записать только одну строчку – об этом ниже. Если пока никаких специфических настроек нет, оставить пустым.</p><p>Далее как при обычном запуске контейнера с обратным прокси от jwilder с помощью docker run или docker-compose в переменную среды VITRUAL_HOST вписать “example.com”.<br>При перезапуске контейнера nginx он кроме прочих автоматически добавит в /path/to/conf.d/default.conf строчки<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://example.com;</span><br><span class="line">    include /etc/nginx/vhost.d/example.com_location;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>Основная настройка на этом завершена.<br>В случае, когда потребуется сделать перенаправление, в файл добавим строчку с даннными о том, куда перенаправить сайт:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'return 302 http://new-path.com;'</span> &gt; /path/to/vhost.d/example.com_location</span><br></pre></td></tr></table></figure></p><p>Код 302 – “Moved Temporarily”.</p><p>Теперь для автоматизации нужно найти конкретный файл, изменить таким образом его содержимое и перезагрузить настройки для nginx:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> nginx sh -c <span class="string">'exec nginx -s reload'</span></span><br></pre></td></tr></table></figure></p><p>Если дойдём до той пресловутой автоматизации, напишу об этом после.<br>Замечание: если сайт доступен по нескольким адресам – например, <a href="http://www.example.com" target="_blank" rel="noopener">www.example.com</a> и example.com, – рекомендуют использовать символические ссылки.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;По работе потребовалось: на некоторый период времени перенаправлять запросы на другой сайт (отправлять клиентов, которые не платят за услугу, на страницу оплаты). Используется &lt;a href=&quot;https://hub.docker.com/r/jwilder/nginx-proxy/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;автоматический обратный прокси-сервер nginx от jwilder&lt;/a&gt;.&lt;br&gt;Решение кажется очевидным и простым (и, вероятно, грубым), но я определённо рада, что нашла хоть такое. Основное преимущество: &lt;strong&gt;настройки в отдельном файле для каждого сайта&lt;/strong&gt;, что делает проще автоматизацию перенаправления.&lt;/p&gt;
&lt;p&gt;Для этого при создании контейнера с nginx нужно прописать дополнительные тома для настроек: conf.d для общих настроек и vhost.d, где будут храниться файлы для каждого виртуального хоста.&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ docker run -d -p 80:80 -p 443:443 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  --name nginx \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -v /path/to/conf.d:/etc/nginx/conf.d \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -v /path/to/vhost.d:/etc/nginx/vhost.d:ro \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  jwilder/nginx-proxy&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Работа" scheme="http://mariepaganel.github.io/categories/%D0%A0%D0%B0%D0%B1%D0%BE%D1%82%D0%B0/"/>
    
    
      <category term="Docker" scheme="http://mariepaganel.github.io/tags/Docker/"/>
    
      <category term="nginx" scheme="http://mariepaganel.github.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Первый пост</title>
    <link href="http://mariepaganel.github.io/2018/04/first-post/"/>
    <id>http://mariepaganel.github.io/2018/04/first-post/</id>
    <published>2018-04-13T23:18:43.000Z</published>
    <updated>2018-04-14T12:56:00.485Z</updated>
    
    <content type="html"><![CDATA[<figure class="left half-width"><br>  <img src="/images/typewriter.jpg" alt="Новый блог! so exciting!"><br></figure><p>Я создала новый блог, ура! Поскольку некоторые платформы, на которых я пытаюсь вести блоги, в последнее время то и дело оказываются под угрозой закрытия или блокировки, мне остаётся только завести ещё один блог!<br>Этот блог совершенно открытый и, вероятно, будет посвящён в основном вещам техническим, связанным с работой и личными открытиями. И, конечно, для Верна место найдётся! За личными постами, которые открываются только для друзей, придётся заходить в другие мои блоги. Я постараюсь их не забрасывать.<br><a id="more"></a></p><h3 id="Кто-я"><a href="#Кто-я" class="headerlink" title="Кто я"></a>Кто я</h3><p>Я решила для этого блога не скрывать свою фамилию. Но чаще я использую никнейм <em>Marie Paganel</em> или <em>Мари Паганель</em> – в честь одного из любимых литературных героев.<br>Я начинающий разработчик на php и начинающий DevOps в одной маленькой и тоже во многом начинающей конторе. Эта новая работа меня и вдохновила начать новый блог. Я хочу развиваться и изучать новое! Здесь, конечно, будут полезные заметки на этом пути.<br>Ещё я жюль-вернистка. Это значит, что я изучаю жизнь и творчество писателя Жюля Верна, участвую в мероприятиях, ему посвящённых (случается, даже организовываю), пишу о нём статьи и просто постоянно читаю его и сообщаю всем, что ещё нового вычитала. Список самых важных или интересных (или напечатанных) моих статей появится на странице About/Обо мне.<br>Я администратор группы <a href="http://vk.com/j_vern" target="_blank" rel="noopener">Произведения Жюля Верна</a>, если вы ещё не знаете о ней – скорее подпишитесь! Ещё в социальной сети ВКонтакте я веду группу <a href="http://vk.com/read_write" target="_blank" rel="noopener">Читательский дневник</a>, где с большим удовольствием провожу “Книжные фанты” – игру, где каждую неделю можно задать кому-то и получить для себя случайную книгу для чтения.<br>Я, случается, пишу фанфикшен (по книгам Верна и не только), и в основном он собран в моём долгоживущем <a href="http://mariepaganel.diary.ru" target="_blank" rel="noopener">блоге на diary.ru</a>. Там же появляются личные посты, открытые только для постоянных читателей (подписка бесплатно, нужно только зарегистрироваться).</p><p>Должно быть, первые читатели этого блога – мои друзья и подписчики с других ресурсов. Привет вам всем! Если хотите, напишите приветственный комментарий, мне будет очень приятно!</p><h3 id="Благодарности"><a href="#Благодарности" class="headerlink" title="Благодарности"></a>Благодарности</h3><p>Этот блог потребовал немного больше работы, чем прежние. Я освоила <a href="http://hexo.io" target="_blank" rel="noopener">Hexo</a>, что, впрочем, несложно, и научилась публиковать статичные веб-сайты на <a href="http://pages.github.com" target="_blank" rel="noopener">GitHub Pages</a>. Мне помогли курсы <a href="https://app.pluralsight.com/library/courses/static-site-generator-build-better-blog" target="_blank" rel="noopener">“Build a Better Blog with a Static Site Generator”</a> и <a href="https://thegymnasium.com/courses/GYM/107/0/about" target="_blank" rel="noopener">“Modern Web Design”</a>.<br>Фотография-баннер сделана by Jessica Lewis, <a href="https://www.pexels.com/photo/red-fruits-on-table-699380/" target="_blank" rel="noopener">я взяла это фото с сайта Pexels</a>.</p><h3 id="Добро-пожаловать"><a href="#Добро-пожаловать" class="headerlink" title="Добро пожаловать!"></a>Добро пожаловать!</h3>]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;left half-width&quot;&gt;&lt;br&gt;  &lt;img src=&quot;/images/typewriter.jpg&quot; alt=&quot;Новый блог! so exciting!&quot;&gt;&lt;br&gt;&lt;/figure&gt;

&lt;p&gt;Я создала новый блог, ура! Поскольку некоторые платформы, на которых я пытаюсь вести блоги, в последнее время то и дело оказываются под угрозой закрытия или блокировки, мне остаётся только завести ещё один блог!&lt;br&gt;Этот блог совершенно открытый и, вероятно, будет посвящён в основном вещам техническим, связанным с работой и личными открытиями. И, конечно, для Верна место найдётся! За личными постами, которые открываются только для друзей, придётся заходить в другие мои блоги. Я постараюсь их не забрасывать.&lt;br&gt;
    
    </summary>
    
      <category term="День за днём" scheme="http://mariepaganel.github.io/categories/%D0%94%D0%B5%D0%BD%D1%8C-%D0%B7%D0%B0-%D0%B4%D0%BD%D1%91%D0%BC/"/>
    
    
      <category term="блог" scheme="http://mariepaganel.github.io/tags/%D0%B1%D0%BB%D0%BE%D0%B3/"/>
    
      <category term="hexo" scheme="http://mariepaganel.github.io/tags/hexo/"/>
    
  </entry>
  
</feed>
